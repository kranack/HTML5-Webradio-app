var DEBUG=0,POOL_CURRENT_RADIO=0,POOL_DATA_RADIOS=[],POOL_DATA_SERVERS=[],SERVER_URL="http://i.sa.123.fr/uploads/webradio-server/",Comet=Class.create();Comet.prototype={server:"",address:"",name:"",url:"",noerror:!0,current_track:"",initialize:function(){},setDatas:function(e,n,a,t){this.server=e,this.address=a,this.name=n,this.url=t,displayDebug("Comet initialized")},connect:function(){this.ajax=new Ajax.Request(this.url,{method:"GET",parameters:{server:this.server,address:this.address,current_track:this.current_track},onSuccess:function(e){displayDebug("OK : "+e.responseText);var n=e.responseText.evalJSON();this.comet.current_track=n.now_playing.track,displayDebug("current_track : "+n.now_playing.track),this.comet.handleResponse(n),displayDebug("OK : Handle response"),this.comet.noerror=!0,displayDebug("OK : set noerror to true")},onFailure:function(e){console.log(e.status+": Something went wrong")},onComplete:function(){this.comet.noerror?(this.comet.connect(),displayDebug("Connect again")):(setTimeout(function(){comet.connect()},5e3),displayDebug("Error : set Timeout")),this.comet.noerror=!1}}),this.ajax.comet=this},disconnect:function(){},handleResponse:function(e){$("radio").innerHTML=this.name,$("infos").innerHTML=this.parseResponse(e)},parseResponse:function(e){var n="";switch(displayDebug("DEBUT PARSEREPONSE"),this.server){case"chillstep":displayDebug("CASE chillstep");var a=e.now_playing.artist.split("-");$("infos").innerHTML=a[1]+" - "+e.now_playing.track,$("radio").innerHTML=a[0];break;default:displayDebug("DEFAULT CASE"),e.now_playing.emission?(displayDebug("EMISSION == TRUE"),e.now_playing.animateur?(displayDebug("ANIMATEUR == TRUE"),n=""==e.now_playing.track?"<b>"+e.now_playing.emission+"</b> avec "+e.now_playing.animateur+"<br>"+setToLowerCase(e.now_playing.artist):"<b>"+e.now_playing.emission+"</b> avec "+e.now_playing.animateur+"<br>"+setToLowerCase(e.now_playing.artist)+" - "+e.now_playing.track):(displayDebug("ANIMATEUR == FALSE"),n=""==e.now_playing.track?"<b>"+e.now_playing.emission+"</b> <br>"+setToLowerCase(e.now_playing.artist):"<b>"+e.now_playing.emission+"</b> <br>"+setToLowerCase(e.now_playing.artist)+" - "+e.now_playing.track)):(displayDebug("EMISSION == FALSE"),n=""==e.now_playing.track?setToLowerCase(e.now_playing.artist):setToLowerCase(e.now_playing.artist)+" - "+e.now_playing.track),displayDebug("END DEFAULT CASE")}return displayDebug("END SWITCH"),$("cover").innerHTML=e.now_playing.cover?'<a href="http://www.google.com/search?q='+setToLowerCase(e.now_playing.artist)+'" target="_blank" ><img src="'+e.now_playing.cover+'" alt/></a>':"",n}};var Datas=Class.create();Datas.prototype={initialize:function(){},getRadiosList:function(){this.ajax=new Ajax.Request("./radios.json",{method:"GET",onSuccess:function(e){data=e.responseText.evalJSON(),POOL_DATA_RADIOS=data.radios},onFailure:function(){console.log("GET RADIOS LIST: Something went wrong")}})},getServersList:function(){this.ajax=new Ajax.Request("./servers.json",{method:"GET",onSuccess:function(e){data=e.responseText.evalJSON(),POOL_DATA_SERVERS=data.servers},onFailure:function(){console.log("GET SERVERS LIST: Something went wrong")}})}};var Player=Class.create();Player.prototype={radioPlayerContainer:null,radioPlayer:null,btnPlay:null,btnPause:null,btnStop:null,btnVolLess:null,btnVolMore:null,initialize:function(){},displayRadios:function(){for(var e="",n=0;n<POOL_DATA_RADIOS.length;n++)e+='<option id="'+POOL_DATA_RADIOS[n].id+'" value="'+n+'" >',e+=POOL_DATA_RADIOS[n].name,e+="</option>";$("chooseRadio").innerHTML=e}};var datas=new Datas;datas.getServersList(),datas.getRadiosList();var player=new Player;player.displayRadios.delay(1);